# SkywarnPlus-NG Default Configuration

# Application settings
enabled: true
poll_interval: 60  # seconds
data_dir: "/var/lib/skywarnplus-ng/data"

# NWS API configuration
nws:
  base_url: "https://api.weather.gov"
  timeout: 30
  user_agent: "SkywarnPlus-NG"

# County configuration (add your counties here)
counties:
  - code: "TXC039"  # Brazoria County, TX
    name: "Brazoria County"
    enabled: true
    audio_file: null  # Optional: Audio file for county name (e.g., "Brazoria.wav")
  - code: "TXC201"  # Galveston County, TX
    name: "Galveston County"
    enabled: true
    audio_file: null  # Optional: Audio file for county name (e.g., "Galveston.wav")

# Asterisk configuration
asterisk:
  enabled: true
  # Simple format: All nodes monitor all enabled counties
  nodes: [546050]  # Add your node numbers here (example: 546050)
  
  # Advanced format: Configure specific counties per node (for multiple nodes serving different locations)
  # Uncomment and modify the example below to use per-node county monitoring:
  # nodes:
  #   - number: 546050
  #     counties: ["TXC039", "TXC201"]  # This node only monitors Brazoria and Galveston counties
  #   - number: 546051
  #     counties: ["TXC201", "TXC167"]  # This node only monitors Galveston and Harris counties
  #   - number: 546052
  #     counties: null  # Or omit 'counties' entirely - this node monitors ALL enabled counties
  
  audio_delay: 0  # Delay in milliseconds before playing audio
  playback_mode: "local"  # Playback mode: "local" (default) or "global" for rpt playback
  courtesy_tones:
    enabled: false  # Enable automatic courtesy tone switching
    tone_dir: "SOUNDS/TONES"  # Directory where tone files are stored
    tones: {}  # Configure CT mappings: {"ct1": {"Normal": "Boop.ulaw", "WX": "Stardust.ulaw"}}
    ct_alerts: []  # Alert events that trigger WX mode (e.g., ["Tornado Warning", "Severe Thunderstorm Warning"])
  id_change:
    enabled: false  # Enable automatic ID changing
    id_dir: "SOUNDS/ID"  # Directory where ID files are stored
    normal_id: "NORMALID.ulaw"  # Audio file for normal mode ID
    wx_id: "WXID.ulaw"  # Audio file for WX mode ID
    rpt_id: "RPTID.ulaw"  # Audio file that Asterisk uses as ID
    id_alerts: []  # Alert events that trigger WX mode (e.g., ["Tornado Warning", "Severe Thunderstorm Warning"])

# Audio configuration
audio:
  sounds_path: "SOUNDS"
  alert_sound: "Duncecap.wav"
  all_clear_sound: "Triangles.wav"
  separator_sound: "Woodblock.wav"
  temp_dir: "/tmp/skywarnplus-ng-audio"
  tts:
    engine: "gtts"  # Options: "gtts" or "piper"
    # gTTS settings
    language: "en"
    tld: "com"
    slow: false
    # Piper TTS settings (only used when engine is "piper")
    model_path: null  # Path to Piper TTS model file (.onnx). Install script installs en_US-amy to /var/lib/skywarnplus-ng/piper/
    speed: 1.0  # Speech speed for Piper (1.0 = normal, >1.0 = faster, <1.0 = slower)
    # Common settings
    output_format: "ulaw"  # ulaw format for Asterisk compatibility
    sample_rate: 8000  # 8kHz required for ulaw format
    bit_rate: 128

# Alert filtering
filtering:
  max_alerts: 99
  blocked_events: []  # Glob patterns for globally blocked events
  say_alert_blocked: []  # Events blocked from voice announcement
  tail_message_blocked: []  # Events blocked from tail message

# Alert behavior
alerts:
  say_alert: true
  say_all_clear: true
  tail_message: true
  tail_message_path: null  # Path for tail message file (default: /var/lib/skywarnplus-ng/data/wx-tail.wav)
  tail_message_suffix: null  # Optional suffix audio file to append to tail message
  tail_message_counties: false  # Include county names in tail message
  with_county_names: false
  time_type: "onset"  # "onset" or "effective"
  say_alert_suffix: null  # Optional suffix audio file to append to alert announcements
  say_all_clear_suffix: null  # Optional suffix audio file to append to all-clear announcements
  say_alerts_changed: true  # Announce alerts when county list changes
  say_alert_all: false  # Say all alerts when one changes (requires say_alerts_changed)
  with_multiples: false  # Tag alerts with "with multiples" if multiple instances exist

# Script execution
scripts:
  enabled: true
  default_timeout: 30
  alert_scripts:
    # Example: Send SMS for tornado warnings
    "Tornado Warning":
      command: "/usr/local/bin/send-sms.sh"
      args: ["Tornado Warning detected in area"]
      timeout: 10
      enabled: true
    # Example: Update status page for severe weather
    "Severe Thunderstorm Warning":
      command: "/usr/local/bin/update-status.sh"
      args: ["severe", "active"]
      timeout: 15
      enabled: true
    # Example: Pattern matching for all flood alerts
    "Flood*":
      command: "/usr/local/bin/flood-alert.sh"
      args: ["$ALERT_EVENT", "$ALERT_AREA"]
      timeout: 20
      enabled: true

# Logging configuration
logging:
  level: "INFO"
  file: "/var/log/skywarnplus-ng/skywarnplus-ng.log"  # Set to null to disable file logging
  format: "json"  # "json" or "text"

# Database configuration
database:
  enabled: true
  url: null  # Use SQLite by default, set to PostgreSQL/MySQL URL for production
  cleanup_interval_hours: 24  # Run cleanup every 24 hours
  retention_days: 30  # Keep data for 30 days
  backup_enabled: false  # Enable for production
  backup_interval_hours: 24

# Monitoring configuration
monitoring:
  enabled: true
  health_check_interval: 60  # Health check interval in seconds
  http_server:
    enabled: true
    host: "0.0.0.0"
    port: 8100
    base_path: ""  # Set to "/skywarnplus-ng" for reverse proxy
  metrics:
    enabled: true
    retention_days: 7

# SkyDescribe DTMF configuration
skydescribe:
  enabled: true
  descriptions_dir: "/var/lib/skywarnplus-ng/descriptions"
  cleanup_interval_hours: 24
  max_file_age_hours: 48
  max_words: 150  # Maximum words in description
  # DTMF codes configuration - basic setup, will be extended with additional codes later
  # These codes can be mapped in Asterisk's rpt.conf or extensions.conf
  # Example mapping in rpt.conf: 841 = cmd,/path/to/skywarnplus-ng dtmf describe 1
  dtmf_codes:
    # Basic DTMF codes - configure these to match your Asterisk setup
    # In the original SkywarnPlus, these were typically mapped to SkyDescribe with alert indices
    current_alerts: "*1"      # Current active weather alerts summary
    alert_by_id: "*2"         # Specific alert by ID (followed by 4-digit ID)
    all_clear: "*3"           # All-clear status
    system_status: "*4"       # System status information
    help: "*5"                # Help and available commands

# PushOver notification configuration
pushover:
  enabled: false  # Set to true to enable PushOver notifications
  api_token: null  # Your PushOver application API token (create at https://pushover.net/apps/build)
  user_key: null  # Your PushOver user key (find at https://pushover.net/)
  priority: 0  # Default priority: -2 (silent) to 2 (emergency), 0 is normal
  sound: null  # Sound name (null = device default). See https://pushover.net/api#sounds
  timeout_seconds: 30
  retry_count: 3
  retry_delay_seconds: 5

# Development and testing configuration
dev:
  # Enable test alert injection (for testing without NWS API)
  inject_enabled: false
  
  # List of test alerts to inject
  # Optionally specify CountyCodes and/or EndTime for each alert
  # Example:
  # inject_alerts:
  #   - Title: "Tornado Warning"
  #     CountyCodes: ["TXC039", "TXC201"]
  #   - Title: "Severe Thunderstorm Warning"
  #     EndTime: "2024-01-15T12:00:00Z"
  #   - Title: "Flood Watch"
  inject_alerts: []
  
  # Clear all cached state on startup
  cleanslate: false
